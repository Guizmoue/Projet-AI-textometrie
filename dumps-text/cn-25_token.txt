稀土 掘金 稀土 掘金

• 首 页
□ 首 页
□ 沸点
□ 课程
□ 直播
□ 活动
□ 竞赛 商城 APP 插件
□
☆ [ ]
搜索 历史 清空
☆ 创作者 中心
○
写 文章
○
发沸点
○
写 笔记
○
写 代码
○
草稿 箱
创作 灵感 查看 更 多
□ vip
会员
□ 登录
注册

AI 绘画 ： StableDiffusion 炼丹Lora攻 略 - 实 战萌 宠 图片 生成

程序员M
2023 - 07 - 0 9 1 , 394

写 在 前面 的 话

近期 在 小 红书 发现 了 许多 极其 可爱 、 美观 的 萌宠 图片 ， 对 这些 美妙 的 图像 深深 着迷

于是 想 着 看看 利用 AI绘画 StableDiffusion 以下 简称 （ SD ） 做出 来 。

以下 是 详细 实操 的 全 过程 ， 包括 所有用 的 资料 已经 打包 到 网盘 。

[ c 27654 d 629 ]

最后 尝试 的 最终 效果 如下 ：

更 多 图片 请 查看 网盘 ：

「萌 宠 图片 及 关键 词」

链接 ： pan . quar k . cn / s / ba9 c 3 e 8ef …

[ 651ea3ec 29 ]

[ d 620ba 2 d 47 ]

如果 你 想 了 解 更 多 的 StableDiffusion 的 知识 ， 请 参阅 ：

AI 绘画 ： Stable Diffusion 终极 炼丹 宝典 ： 从 入 门 到 精通

原 文链 接 阅读 更 舒服 ： AI 绘画 ： StableDiffusion 炼丹Lora攻 略 - 实 战萌 宠 图片 生成

一 ： 准备

需要 的 资料 都 打包 在 网盘 里面 ， 需要 的 自行 下载 。

我 用 夸克 网盘 分享 了 「StableDiffusion 炼丹 资料 」

网盘链 接 ： pan . quar k . cn / s / 3c 8cc96f3 …

[ 605b2669ac ]

二 、 Lora 作用

LORA 可以 让 我们 轻松 画 出 特定 的 人物 ， 物品 ， 特殊 的 笔触 和 特殊 的 画风 或 风格 ， 属于 一 种
特殊 训练 的 子集 。

1 . AI模特

炼 出 一个 自己 的 模特 ， 让 这个 模特 穿 上 自己 的 商品

[ ab903616d8 ]

2 . 炼 衣服Lora

添加 一个 衣服 的 Lora ， 就 可以 让 人物 穿 上 特定 的 衣服

[ 2 b 2 f 8deb6 e ]

3 . 改变 画风 / 画面 背景

通过 添加Lora 改变 照片 的 画风 ， 这个 画风 可以 自己 去 训练

[ 45 c 57d049 e ]

Lora 模型 究竟 是 什 么 ？

专业 的 解释

LoRA 的 全称 是 LoRA : Low - Rank Adaptation of Large Language Models ， 可以 理解 为
stable diffusion （ SD ) 模型 的 一 种 插件 ， 和 hyper - network ， controlNet 一样 ， 都 是 在 不
修改 SD 模型 的 前提 下 ， 利用 少量 数据 训练 出 一 种 画风 / IP / 人物 ， 实现 定制化 需求 ， 所 需 的
训练 资源 比 训练S D模 要 小 很 多 ， 非常 适合 社区 使用者 和 个人 开发者 。 LoRA 最初 应用 于 NLP领
域 ， 用于 微调 GPT - 3 等 模型 （ 也 就是 ChatGPT 的 前生 ） 。 由于 GPT 参 数量 超过 千亿 ， 训练 成本
太 高 ， 因此 LoRA 采用 了 一个 办法 ， 仅 训练 低 秩矩阵 （ low rank matrics ） ， 使用 时 将 LoRA
模型 的 参数 注入 （ inject ） SD 模型 ， 从而 改变 SD 模型 的 生成 风格 ， 或者 为 SD 模型 添加 新 的
人物 / IP 。

通俗 的 解释

Lora 可以 复刻 人物 和 物品 的 特征 ， 固定人物 动作 ， 改变 照片 画风

而且 Lora 只 需要 少量 的 数据 就 可以 训练 出 来 ， 比 训练 大模型 要 简单 很多

所以 大 家 可以 通过 训练 自己 的 Lora ， 做出 定制 的 图片

但 不 得 不 说 的 是 ， 目前 的 Lora 还 不 能 做到 100 % 相同 ， 尤其 是 细节 方面

但是 相信 随着 之后 的 技术 发展 ， 万物 皆 可 Lora 的 时代 是 不 远 的

三 、 如何 炼制 自己 的 Lora 模型 ？

炼制Lora 的 方式 有 很多 种

有用 脚本 训练 的 ， 也 有 在 网站 界面 上 训练 的 ， 最近 还有 很多 朋友 做出 来 了 训练Lora 的 整合
包

创建 Lora模型 的 方式 有 许多 ， 包括 通过 脚本 进行 训练 ， 通过 网页 界面 操作 ， 甚至 有 一些 专
业 人士 最近 提供 了 Lora 训练 的 一 键式 整合包 。 尽管 这些 方法 在 表面 上 看 起 来 有所 不 同 ， 但
其 训练 逻辑 其实 都 是 相同 的 。

因此 ， 我们 可以 选择 使用 整合包 。 整合包 的 优点 在于 ， 它 将 炼丹 所 需 的 所有 工具 和 步骤 集
成 在 一 款 软件 中 ， 为 我们 提供 了 一 种 更为 便捷 且 有效 的 训练 方式 。

整合包 就是 把 炼丹 所 需要 的 所有 工具 都 整合 到 一个 软件 里

炼丹 分为 以下 几 步 ：

1 . 下载 整合 包

2 . 准备 工作

3 . 开始 训练

4 . 测试Lora

5 . 优化 Lora

四 、 炼丹 前 的 准备 （ 下载 整合包 ）

在 炼Lora 之前 ， 需要 大 家 先 确认 一下 自己 的 电脑 配置 ：

1 . 电脑 配置 需要 N卡 ， 并且 6 G 显存 以上

2 . A卡 和 Mac 系统 ， 或者 电脑 配置 不 太行 的 小伙伴 建议 用 云平台

我 这里 用 的 是 B站up主 朱尼酱 的 整合包 ：

我 用 夸克 网盘 分享 了 「StableDiffusion 炼丹 资料 」

网盘链 接 ： pan . quar k . cn / s / 3c 8cc96f3 …

下载 好 了 之后 把 它 解压 到 D盘 或者 E盘 ， 不 要 放在 C盘 ！ ！

秋叶 的 整合包 我 也 试 过 炼Lora ， 两 个 对比 下 来 ， 我 觉得 朱尼酱 的 整合包 会 更 适合 小白

打开 解压 之后 的 文件 夹 ， 在 “ cfurnace _ ui ” 文件 夹 里面 找到 “ 赛博丹炉 ” 的 应用 程序

[ 6 b 7454e893 ]

可以 创建 一个 桌面 快捷 方式 ， 这样 就 不 用 每 次 都 要 打开 文件

看到 这个 页面 就 安装 好 了 ， 点击 “ 开启 炼丹炉 ” 就 可以 开始 炼Lora 啦 ！

[ 94b362e 380 ]

五 、 选择 合适 的 大 模型

跟 画图 一样 ， 炼Lora 之前 也 要 先 选 一个 大 模型 ， 确定 Lora 的 画风

这里 训练 的 萌宠 ， 我 选择 的 是 “ cheeseDaddys _ 35 ” 大 模型

真人 模型 = 》 选用 “ chilloutmix ” 的 大模型

二 次 元 = 》 选用 “ anything ” 的 大模型

如果 你 的 Stable Diffusion 里面 没有 模型 ， 那 就要 先 去 下载 模型 噢 ！

网盘 里面 已经 给 大 家 放 了 这 两 个 大 模型

我 用 夸克 网盘 分享 了 「 2 . 大模型 checkpoint 」

链接 ： pan . quar k . cn / s / 9767ac 274 …

[ 1ae8 e 62 f 5 d ]

再 往 下 就 可以 选择 一个 我们 要 训练 的 Lora 的 类型

选择 之后 就 会 帮 我们 选择 默认 的 参数

训练 真人Lora 就 选 “ 人物 ”

训练 二 次 元 就 选 “ 二 次 元 ”

如果 想 炼 绘画 的 风格 可以 选 画风

除此之外 还 可以 自 定义 去 炼 平面 设计图 或者 建筑 之类 的

我 这里 选择 的 是 产品

[ 24217 c 23 b 5 ]

六 、 高 质量 素材 的 制作

以上 准备 工作 及 参数 设置 好 了 后 ， 就 可以 开始 上 传 自己 的 素材 开始 训练 了 。

这些 素材 就 是 我们 要 喂 给 AI 学习 的 素材

素材 的 质量 非常 重要 ！ ！ 会 直接 影响 最后 出 来 的 Lora 的 质量

我们 的 素材 需要 满足 几 个 点 ：

1 . 上 传 20 ~ 30 张 照片

2 . 素材 要 高清 ！ ！ ！

3 . 多 角度 照片

这里 我 就 以炼 萌宠Lora 为 例子 ， 上传萌 宠 的 照片

点击 “ 删除 全部 ” 把 默认 的 素材 删掉

然后 点击 “ 上 传素材 ” ， 上传 自己 的 照片

[ e d98bdfdbd ]

一 般 情况 下 ， 下面 的 参数 默认 就 可以 了

需要 调整 参数 的 话 ， 最好 是 需要 了 解 参数 的 含义 ， 如果 乱 调 的 话 ， 可能 会 训练 失败 。

不 要 选择 太 高 的 分辨率 ， 容易 爆 显存

另外 ， 如果 训练 真人Lora ， 可以 勾选 最 右边 的 “ 脸部 加强 训练 ”

勾选 了 之后 就 会 再 多 裁剪 出 来 一 组 只有 脸 的 照片 ， 这样 AI 能 学 到 更 多 的 脸部 细节

七 、 耐心 等待 的 训练 过程

[ d 42 f 49fa0 b ]

看到 这个 页面 就 是 模型 正在 训练 中

到 这 一 步 只要 耐心 等待 就 可以 了 ， 没什 么 需要 操作 的

我们 可以 看 一下 下面 的 参数 是 什 么 意思

“ Steps ” 就 是 训练步 数

每 训练 50 步 右 下角 就 会 出现 一 张 图片

那样 就 可以 实 时 看到 Lora 的 样子

这个 白 头发 和 红裙子 是 后台 加上 去 的 关键词

可以 测试Lora 的 泛化性

泛化性 就是 看 这个 Lora 能 不 能 自由 的 去 更换 照片 里 的 东西 ， 比如 发型 、 发色 、 服装 之
类 的

Loss 可以 用 来 参考 模型 的 好坏

一个 好 的 模型 Loss值 在 0 . 07 ~ 0 . 09 之间

注意 ： 具体 好 不 好 还是 要 在 Stable Diffusion 实际 测试 才 知道

等 训练 完 了 之后 ， 点击 “ 模型 ”

就 可以 看到 生成 出 来 模型

按照 默认 参数 训练 会 出 来 20 个 模型 ， 但 不 是 说 最后 一个 模型 就 是 最 好 的

有 可能 炼 到 第十六 第是 十七 个 模型 就 已经 够 了 ， 再 往 后 的 模型 就 已经 训练 过度 了

所以 这些 模型 还要 实际 在 SD 测试 一下 ， 才 知道 哪 个 是 最 好 的

[ 748087c2 a 2 ]

八 、 如何 测试Lora 的 好坏

模型 生成 出 来 之后 就 可以 到 SD 里面 生成 图片

在 SD 里面 可以 生成 这 么 一 张 大图 ， 可以 直接 看到 所有 模型 在 不 同 权重 下 出 来 的 效果

比较 一下 哪 个 模型 更 好 ， 就 只 保留 那个 模型 就 可以 了

[ 7 d a 599f2 a c ]

接 下 来 我们 就 看看 怎 么 生成 这 张 大 图

首先 把 新 生成 的 10 个 模型 复制 到 SD 的 models 文件 夹 ， 放 到 Lora文件 夹 里面

注意 ： 最 好 新建 一个 文件 夹 ， 比如cuteDog

然后 把 没有 序号 编码 的 那个 Lora重 命名

没有 序号 编码 的 Lora 就 是 最后 生成出 来 的 一个 模型 ， 这里 只是 为 了 方便 进行 测试 ， 统
一一下 所有 模型 的 名称

保存 好 模型 之后 就 可以 打开 SD 进行 测试 了

首先 先 选 一个 大 模型

你 用 哪 一个 大 模型 来 训练lora 就 选 哪 个 大 模型

然后 输入 正面 关键词 和 负面 关键词

正面 关键词 可以 输入 一些 质量词 ， 比如 最高 质量 、 高清 画质 、 大师 杰作 等等

负面 关键词 直接 复制 我们 以前 用 过 的 就 可以

接 下 来 就 是 选用 我们 刚刚 炼 好 的 Lora

随便 选 一个 都 可以

[ c0 df 5842de ]

重点 来 了 ： 把000017 换 成 NUM ， 1 换 成 STRENGTH

< lora : cute dog _ 20230708214731 - 000017 : 1 >

例如 ：

< lora : cute dog _ 20230708214731 - NUM : STRENGTH >

迭代 步数 ， 采样 方法 这些 参数 大 家 可以 按照 自己 的 习惯 去 修改

然后 滑 到 最 下面 找到 “ 脚本 ”

在 脚本 里面 选择 “ X / Y / Z图表 ”

X轴 、 Y轴 类型 都 选择 “ 提示词 搜索 / 替换 ”

X轴 的 值 输入 ：
NUM , 000001 , 000002 , 000003 , 000004 , 000005 , 000006 , 000007 , 000008 , 000009 , 000010

这里 的 序号 对应 的 就是 我们 10 个 Lora 的 编号

Y轴值 输入 ： STRENGTH , 0 . 1 , 0 . 2 , 0 . 3 , 0 . 4 , 0 . 5 , 0 . 6 , 0 . 7 , 0 . 8 , 0 . 9 , 1

这里 的 序号 代表 的 是 Lora 的 权重

[ 5737eaa0 d c ]

全部 参数 设置 好 了 之后 就 可以 点击 “ 生成 ”

生成出 来 就 是 这 么 一 张 大图 ， 可以 看到 这 几 个 Lora 模型 在 不 同 强度 下 的 表现

九 、 如何 优化 Lora

实际上 ， 炼丹 是 一 件 比较 玄学 的 事

有 的 人 可能 一次性 就 能 炼 出 自己 满意 的 Lora

但 有 的 人 可能 要 炼 好几 次 才 出 来 一个 好 的 Lora

这时候 我们 可以 通过 调整 训练 的 参数 再 重新 炼 一个

前提 是 确保 我们 的 喂 给 AI 的 素材 是 高 质量 的 ！

不 然 不 管怎 么 修改 参数 ， 出 来 的 Lora 都 是 不 合格 的

这里 我们 就 把 炼Lora会 遇到 的 问题 分成 两 种 情况

1 . Lora出 来 的 照片 不 像 本人 ： AI没学 好

2 . Lora 过 拟合 ， 甚至 出 来 的 照片 崩 了 ： AI学 过 头 了

过 拟合 就 是 不 管 输入什 么 关键词 ， 出 来 的 照片 都 是 你 喂 给 AI 的 照片

没 办法 自由 控制 人物 的 服装 、 发型 、 发色 等

[ 3945b 20 f 94 ]

点击 “ 参数 调优 ” 我们 就 可以 自行 设置 参数

[ aea4248b82 ]

如果 生成 的 照片 不 像 本人 ， 那 就 可以 适当 增加 Repeat （ 学习 步数 ） 值

如果 照片 过 拟合 了 ， 那 就 减少 Repeat值

其他 参数 都 可以 不 用调 ， 因为 默认 的 参数 就 差 不 多 是 最 优值 了

十 、 资源 下载 汇总

Lora炼丹 网盘 资源 汇总 ： pan . quar k . cn / s / 3c 8cc96f3 …

StableDiffusion 资源 整合 安装 包 ： pan . quar k . cn / s / 2750beda9 …

StableDiffusion 关键词 分类 查询 ： StableDiffusion 的 关键词 分类 查询

ControlNet 资料 汇总 ： pan . quar k . cn / s / 47bc 8 c 798 …

AI资料 网盘 汇总 （ 不 定期 更新 ） ： AI专区 网盘 资源 汇总

AIGC 从 入 门 到 精通 教程 汇总 ： AIGC 从 入 门 到 精通 教程 汇总

原 文链 接 阅读 更 舒服 ： AI 绘画 ： StableDiffusion 炼丹Lora攻 略 - 实 战萌 宠 图片 生成


avatar
程序员M 创作 等级L V . 3

40
文章

25 k
阅读

47
粉丝
目录
收起

• 写 在 前面 的 话
• 一 ： 准备
• 二 、 Lora 作用
□ 1 . AI模特
□ 2 . 炼 衣服Lora
□ 3 . 改变 画风 / 画面 背景
□ Lora 模型 究竟 是 什 么 ？
• 三 、 如何 炼制 自己 的 Lora 模型 ？
• 四 、 炼丹 前 的 准备 （ 下载 整合包 ）
• 五 、 选择 合适 的 大 模型
• 六 、 高 质量 素材 的 制作
• 七 、 耐心 等待 的 训练 过程
• 八 、 如何 测试Lora 的 好坏
• 九 、 如何 优化 Lora
• 十 、 资源 下载 汇总

相关 推荐

快速 出 效果 ！ 设计师 必备 的 5 个 AI 绘画 软件
222 阅读
  ·  
3 点 赞

AI 绘 图 ： MidJourney 的 提示 语句 （ Prompt ） 怎 么 写 ？
4 . 2 k 阅读
  ·  
17 点 赞

AI 绘画 Stable Diffusion 实战 操作 ： 62 个 咒语 调教 - 时 尚 杂志 封面
626 阅读
  ·  
1点 赞

如何 像 导演 一样 为 Midjourney 图片 营造 各种 戏剧 效果 ( 机位 和 镜头 )
775 阅读
  ·  
2 点 赞

AI 绘画 Midjourney 最 详细 易 懂 的 注册 使用 教程
2 . 5 k 阅读
  ·  
11点 赞
